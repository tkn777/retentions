.TH RETENTIONS 1 "2025" "retentions" "User Commands"
.SH NAME
retentions \- apply backup-style retention rules to any file set

.SH SYNOPSIS
.B retentions
.I PATH PATTERN
[options]

.SH DESCRIPTION
.B retentions
is a small CLI tool to prune file sets using backup-style time-based retention rules.

It groups files into time buckets (hours, days, weeks, months,
quarters, years) and keeps only one representative file per bucket,
typically the most recent one. Everything outside the defined
retention scope is removed unless
.BR --dry-run
or
.BR --list-only
is used.

The tool is deterministic and dependency-free.

.SH WARNING
This tool permanently deletes files outside the retention scope.

Always verify behavior first using
.BR --dry-run .

The author assumes no liability for data loss.

.SH LOGIC SUMMARY
.IP 1. 3
Collect all matching files under the given path.
.IP 2.
Sort by modification time (newest first).
.IP 3.
Keep:
.RS
.IP \(bu 2
Newest file per retention period (hour/day/week/month/quarter/year)
.IP \(bu
The last N files when using
.B --last
.RE
.IP 4.
Delete all other files.
.IP 5.
With
.B --dry-run
only planned actions are printed.

.SH ARGUMENTS
.TP
.I path
Base directory to scan. Mandatory.
.TP
.I file_pattern
Glob pattern (default) or regex if
.B --regex
is used. Mandatory.
.TP
.B -r, --regex
Interpret file_pattern as a regular expression instead of a glob.

.SH RETENTION OPTIONS
.TP
.B -h, --hours
Keep one file per hour for the last N hours.
.TP
.B -d, --days
Keep one file per day for the last N days.
.TP
.B -w, --weeks
Keep one file per week for the last N weeks.
.TP
.B -m, --months
Keep one file per month for the last N months.
.TP
.B -q, --quarters
Keep one file per quarter for the last N quarters (quarter by months).
.TP
.B --week13
Keep one file per 13-week block from the last N 13-week blocks (quarter by weeks).
.TP
.B -y, --years
Keep one file per year for the last N years.
.TP
.B -l, --last
Always keep the N most recent files regardless of age.

.PP
At least one retention option must be specified.

Every retention option can be combined with any (or all) others

Retention periods are cumulative. A file kept by one retention level is not considered for another.

Exception:
.B --last
overrides all other retention periods.

.SH BEHAVIOR OPTIONS
.TP
.B -L, --list-only [separator]
Output only files that would be deleted.
Incompatible with
.BR --verbose .
Default separator: newline.
.TP
.B -V, --verbose [level]
Verbosity level:
0 = silent
1 = deletions only
2 = detailed (default)
3 = debug
If used without value, defaults to level 2.
.TP
.B -X, --dry-run
Simulate actions without deleting anything.

.SH COMMON OPTIONS
.TP
.B -H, --help
Show usage information.
.TP
.B -R, --version
Show version information.

.SH EXAMPLES
.TP
Keep last 7 days, 4 weeks and 6 months:
.EX
retentions /data/backups '*.tar.gz' -d 7 -w 4 -m 6
.EE

.TP
Dry run:
.EX
retentions /data/backups '*.tar.gz' -d 10 -w 3 -m 6 --dry-run
.EE

.TP
List-only mode with null separator (for piping):
.EX
retentions /data/backups '*.tar.gz' -d 5 -w 12 --list-only '\0' | xargs -0 rm
.EE

.TP
Verbose detailed output:
.EX
retentions /data/backups '*.tar.gz' -d 3 -w 1 --verbose 2
.EE

.SH PATTERN QUOTING
Always quote your file patterns.
If not quoted, your shell may expand them before they reach the
program.

Correct:
.EX
retentions /data/backups '*.tar.gz'
retentions /data/logs 'log-*.txt'
retentions /data/temp '.*\\.bak'
.EE

Incorrect:
.EX
retentions /data/backups *.tar.gz
.EE

.SH EXIT CODES
.TS
tab(|);
l l.
Code | Meaning
---|-------------------------
0 | Success
1 | I/O or filesystem error
2 | Invalid or conflicting arguments
3 | Pattern matched no files
7 | Integrity check failed
9 | Unexpected error
.TE

.SH NON-ATOMIC BEHAVIOR
retentions does not operate atomically. The underlying filesystem is not atomic either.
Directory contents may change while retentions is scanning or evaluating files.

Concurrent modifications to the target
.I path
such as file creation, deletion, or timestamp changes may lead to inconsistent
or incorrect results.

To ensure consistent behavior, make sure that the directory is not modified
during the execution of
.B retentions.

.SH LICENSE
MIT License, Copyright Â© 2025
Thomas Kuhlmann.

.SH AUTHOR
Thomas Kuhlmann <mail@thomas-kuhlmann.de>

.SH PROJECT HOME PAGE
https://github.com/tkn777/retentions
