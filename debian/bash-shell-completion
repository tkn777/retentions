# bash completion for retentions
# Supports positional args (path, pattern) + all options

_retentions_complete()
{
    local cur prev words cword
    _init_completion || return

    # All long/short options
    local opts="
        -h --hours
        -d --days
        -w --weeks
        -m --months
        -q --quarters
        --week13
        -y --years
        -l --last
        -r --regex
        -L --list-only
        -V --verbose
        -X --dry-run
        -H --help
        -R --version
    "

    #
    # Positional argument logic:
    #   1st arg: path → complete directories
    #   2nd arg: file pattern → no filesystem completion, just words
    #

    # 1) Completing first positional argument: <path>
    if [[ $cword -eq 1 ]]; then
        # Suggest directories only
        compopt -o dirnames
        COMPREPLY=( $(compgen -d -- "$cur") )
        return
    fi

    # 2) Completing second positional argument: <file_pattern>
    if [[ $cword -eq 2 ]]; then
        # Do NOT expand filesystem; user types their own pattern → suggest nothing
        COMPREPLY=()
        return
    fi

    # After positional arguments → complete options
    if [[ "$cur" == -* ]]; then
        COMPREPLY=( $(compgen -W "$opts" -- "$cur") )
        return
    fi

    COMPREPLY=()
}

complete -F _retentions_complete retentions
